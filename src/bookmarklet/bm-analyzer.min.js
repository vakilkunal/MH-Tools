(()=>{const e={};function t(e){return new Promise((t,a)=>{const n={start:e,action:"history",uh:user.unique_hash};$.post("https://www.mousehuntgame.com/managers/ajax/users/marketplace.php",n,null,"json").done(e=>{e?t(e):a("Error in POST response data")}).fail(e=>{a(e)})})}function a(t){const a=localStorage.getItem("tsitu-analyzer-data");if(a){const n=JSON.parse(a),o=t.length;let l=o-(e["missing-entries"]-10*Math.floor(e["missing-entries"]/10));10===l&&(l=0);for(let e=l;e<o;e++)n.data.push(t[e]);localStorage.setItem("tsitu-analyzer-data",JSON.stringify(n)),localStorage.setItem("tsitu-analyzer-data-length",n.data.length)}else{const e={};e.data=t,localStorage.setItem("tsitu-analyzer-data",JSON.stringify(e)),localStorage.setItem("tsitu-analyzer-data-length",t.length)}o()}function n(e){return new Promise(t=>setTimeout(t,e))}function o(){let t=0;const a=localStorage.getItem("tsitu-analyzer-data-length");a&&(t=a);const n=e["total-records"]-t,o=Math.ceil(n/10);e["missing-entries"]=n,e["missing-pages"]=o,document.getElementById("mht-marketplace-analyzer-description").innerHTML=`Stored Entries: ${t}<br>Missing Entries: ${n}<br>Pages Remaining: ${o}/${Math.ceil(e["total-records"]/10)}<br>Data Remaining: ${Math.ceil(23.8*o)} KB`}window.jQuery?t(0).then(l=>{e["total-records"]=l.recordsTotal,e.pause=!1,function(){const l=document.createElement("div");l.id="mht-marketplace-analyzer";const r=document.createElement("button");r.textContent="x",r.onclick=function(){document.body.removeChild(l)};const d=document.createElement("span");d.style.fontSize="15px",d.style.fontWeight="bold",d.appendChild(document.createTextNode("Marketplace Analyzer"));const s=document.createElement("span");s.id="mht-marketplace-analyzer-description";const c=document.createElement("span");c.innerHTML="<br><br>Script is running in the background.<br>Feel free to browse in another tab!",c.id="mht-marketplace-analyzer-background",c.hidden=!0;const i=document.createElement("button");i.id="mht-marketplace-analyzer-fetch",i.textContent="Fetch",i.onclick=(()=>{0===e["missing-entries"]&&0===e["missing-pages"]?alert("All available data has been downloaded.\nPlease click 'Send To Tool', or 'Reset Data' if something has broken."):(i.disabled=!0,m.disabled=!1,c.hidden=!1,async function(){let l=10*Math.floor(e["missing-pages"]-1);const r=e["missing-pages"];for(let d=0;d<r&&!(l<0)&&!e.pause;d++){const r=await t(l);if(r.recordsTotal!==e["total-records"]){alert("New transactions(s) detected. Please re-click 'Fetch'!"),e["total-records"]=r.recordsTotal,o();break}const d=r.data.reverse();l-=10,a(d),await n(500)}document.getElementById("mht-marketplace-analyzer-fetch").disabled=!1,document.getElementById("mht-marketplace-analyzer-pause").disabled=!0,e.pause=!1,document.getElementById("mht-marketplace-analyzer-background").hidden=!0}())});const m=document.createElement("button");m.id="mht-marketplace-analyzer-pause",m.textContent="Pause",m.disabled=!0,m.onclick=(()=>{e.pause=!0});const p=document.createElement("button");p.textContent="Send To Tool",p.onclick=(()=>{const e=localStorage.getItem("tsitu-analyzer-data");if(e){const t=window.open("");t.location="https://tsitu.github.io/MH-Tools/analyzer.html",t.name=e}else alert("There is no data to send! Please click 'Fetch'")});const u=document.createElement("button");u.textContent="Reset Data",u.onclick=(()=>{const e=confirm("Are you sure you want to reset the data on MHG?");if(e){const e=localStorage.getItem("tsitu-analyzer-data");e&&(localStorage.removeItem("tsitu-analyzer-data"),localStorage.removeItem("tsitu-analyzer-data-length"),o())}}),l.appendChild(r),l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),l.appendChild(d),l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),l.appendChild(s),l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),l.appendChild(p),l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),l.appendChild(i),l.appendChild(document.createTextNode(" ")),l.appendChild(m),l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),l.appendChild(u),l.appendChild(c),l.style.backgroundColor="#F5F5F5",l.style.position="fixed",l.style.zIndex="9999",l.style.left="40%",l.style.top="88px",l.style.border="solid 3px #696969",l.style.borderRadius="20px",l.style.padding="10px",l.style.textAlign="center",document.body.appendChild(l),o()}()}).catch(e=>{console.log(e)}):alert("Error: jQuery is not enabled on this page")})();